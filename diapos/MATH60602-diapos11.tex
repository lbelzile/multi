% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  ignorenonframetext,
]{beamer}
\usepackage{pgfpages}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
\beamertemplatenavigationsymbolsempty
% Prevent slide breaks in the middle of a paragraph
\widowpenalties 1 10000
\raggedbottom
\setbeamertemplate{part page}{
  \centering
  \begin{beamercolorbox}[sep=16pt,center]{part title}
    \usebeamerfont{part title}\insertpart\par
  \end{beamercolorbox}
}
\setbeamertemplate{section page}{
  \centering
  \begin{beamercolorbox}[sep=12pt,center]{part title}
    \usebeamerfont{section title}\insertsection\par
  \end{beamercolorbox}
}
\setbeamertemplate{subsection page}{
  \centering
  \begin{beamercolorbox}[sep=8pt,center]{part title}
    \usebeamerfont{subsection title}\insertsubsection\par
  \end{beamercolorbox}
}
\AtBeginPart{
  \frame{\partpage}
}
\AtBeginSection{
  \ifbibliography
  \else
    \frame{\sectionpage}
  \fi
}
\AtBeginSubsection{
  \frame{\subsectionpage}
}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{D-DIN}
  \setsansfont[]{Latin Modern Sans}
  \setmathfont[]{Latin Modern Math}
\fi
\usecolortheme{Flip}
\usefonttheme{serif} % use mainfont rather than sansfont for slide text
\useinnertheme{Flip}
\useoutertheme{Flip}
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\newif\ifbibliography
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
\usepackage{caption}
% Make caption package work with longtable
\makeatletter
\def\fnum@table{\tablename~\thetable}
\makeatother
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{tabu}
\usepackage{mathtools}
\usepackage{mathrsfs}
\makeatletter
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[many]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Analyse de regroupements},
  pdfauthor={Léo Belzile},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Analyse de regroupements}
\subtitle{Analyse multidimensionnelle appliquée}
\author{Léo Belzile}
\date{automne 2022}
\institute{HEC Montréal}

\begin{document}
\frame{\titlepage}
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[sharp corners, boxrule=0pt, interior hidden, borderline west={3pt}{0pt}{shadecolor}, frame hidden, breakable, enhanced]}{\end{tcolorbox}}\fi

\begin{frame}{Analyse de regroupements}
\protect\hypertarget{analyse-de-regroupements}{}
\textbf{Objectif}: regrouper des \textbf{observations} de telle sorte
que

\begin{itemize}
\tightlist
\item
  les observations d'un même groupe soient le plus semblables possible,
\item
  les groupes soient le plus différent possible les uns des autres.
\end{itemize}

Chaque observation se voit assigner une étiquette de groupe.

On procède ensuite à une analyse \textbf{descriptive}, segment par
segment.
\end{frame}

\begin{frame}{Exemples}
\protect\hypertarget{exemples}{}
\begin{itemize}
\tightlist
\item
  Programmes de fidélisation et résolution d'entités
\item
  Segmentation de la clientèle de transport en commun et élaboration de
  forfaits
\item
  Démarchage d'organismes de charité
\item
  Segmentation de
  \href{https://fivethirtyeight.com/features/the-6-political-neighborhoods-of-los-angeles/}{quartiers
  de Los Angeles} et de
  \href{https://fivethirtyeight.com/features/the-5-political-boroughs-of-new-york-city/}{New
  York} selon leur vote
\item
  \href{https://www.cbc.ca/news/canada/calgary/danielle-smith-alberta-moderate-middle-ucp-ndp-poll-1.6651460}{Profils
  des électeurs albertains}
\end{itemize}
\end{frame}

\begin{frame}{Illustration}
\protect\hypertarget{illustration}{}
\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/fig-regroupements-bidons-1.pdf}

}

\caption{\label{fig-regroupements-bidons}Données simulées avec deux
regroupements hypothétiques.}

\end{figure}
\end{frame}

\begin{frame}{Analogie avec analyse factorielle}
\protect\hypertarget{analogie-avec-analyse-factorielle}{}
En analyse factorielle, on combine des variables similaires (colonnes).

Pour l'analyse de regroupements, on regroupe des observations (lignes).

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{figures/tidy-data-sub.png}

}

\end{figure}

Ce sont des méthodes dites d'\textbf{apprentissage non-supervisé}:
l'objectif est de déduire la structure présente dans un ensemble de
points \(\mathbf{X}\) sans étiquette préalable (contrairement à la
classification).
\end{frame}

\begin{frame}{Structure de la base de données}
\protect\hypertarget{structure-de-la-base-de-donnuxe9es}{}
Quelles variables \(\mathrm{X}_1, \ldots, \mathrm{X}_p\) sont d'intérêt?

\begin{itemize}
\tightlist
\item
  Choisir des variables pertinentes pour faire ressortir les différences
\item
  Créer de nouvelles variables explicatives
\end{itemize}

Pour les données longitudinales, on va typiquement aggréger les bases de
données marketing par identifiant client.
\end{frame}

\begin{frame}{Exemple avec transport en commun}
\protect\hypertarget{exemple-avec-transport-en-commun}{}
La carte Opus enregistre

\begin{itemize}
\tightlist
\item
  les temps de passage
\item
  le type de déplacement (REM, métro, bus)
\item
  le nombre de passages
\item
  les abonnements
\item
  le profil client (études, rabais pour personnes âgées)
\end{itemize}
\end{frame}

\begin{frame}{Quelles variables créer ou conserver?}
\protect\hypertarget{quelles-variables-cruxe9er-ou-conserver}{}
\begin{itemize}
\tightlist
\item
  Nombre de passages mensuels
\item
  Abonnement mensuel ou annuel (oui/non)
\item
  Type de déplacement (soir, jour)
\item
  Nombre d'allers-retours hebdomadaires en heure de pointe
\item
  Variabilité de la fréquentation
\end{itemize}
\end{frame}

\begin{frame}{À votre tour}
\protect\hypertarget{uxe0-votre-tour}{}
Vous avez toutes les données transactionnelles associées à des comptes
d'épicerie avec un compte de fidélisation.

Quelles variables pourriez-vous créer à partir des données aggrégées
pour créer des segments?
\end{frame}

\begin{frame}{Diviser pour régner}
\protect\hypertarget{diviser-pour-ruxe9gner}{}
Souvent, il existe une division naturelle des données.

Les jeunes avec des abonnements de transport publics l'utilisent
principalement pour aller à l'école.

On peut faire la segmentation \textbf{séparément} pour ces sous-groupes.
\end{frame}

\begin{frame}{Choix des variables}
\protect\hypertarget{choix-des-variables}{}
Recommandations: choisir les variables pertinentes qui font ressortir
les effets voulus.

\begin{itemize}
\tightlist
\item
  inclure de nombreuses variables similaires dilue les différences.
\item
  transformez les variables pour diminuer la corrélation.
\end{itemize}

Typiquement, ne pas utiliser les variables sociodémographiques (âge,
revenu, sexe, etc.)

\begin{itemize}
\tightlist
\item
  on compare plutôt leur répartition au sein des regroupements.
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Exemple - dons à un organisme de charité}
\protect\hypertarget{exemple---dons-uxe0-un-organisme-de-charituxe9}{}
La base de données \texttt{dons} contient 49730 observations pour 16
variables.

\begin{itemize}
\tightlist
\item
  Trois grandes catégories: personnes qui n'ont pas donné, dons uniques,
  dons multiples.
\item
  valeur des dons (total, min, max) et des promesses, nombre de dons,
  fréquence, ancienneté, etc.
\end{itemize}

Une rapide exploration des données révèle que près de 61\% des
employé(e)s n'ont pas donné à l'organisme.

Une poignée de dons sont très élevés, mais la plupart des montants
tourne autour de 5\$, 10\$, 20\$, etc.
\end{frame}

\begin{frame}[fragile]{Modification des données}
\protect\hypertarget{modification-des-donnuxe9es}{}
On se concentre sur les personnes qui ont fait plusieurs dons.

\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\NormalTok{donsmult }\OtherTok{\textless{}{-}}\NormalTok{ hecmulti}\SpecialCharTok{::}\NormalTok{dons }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(ndons }\SpecialCharTok{\textgreater{}}\NormalTok{ 1L) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mtdons =}\NormalTok{ vdons}\SpecialCharTok{/}\NormalTok{ndons,}
         \AttributeTok{snrefus =}\NormalTok{ nrefus}\SpecialCharTok{/}\NormalTok{anciennete}\SpecialCharTok{*}\FunctionTok{mean}\NormalTok{(anciennete),}
         \AttributeTok{mpromesse =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{           npromesse }\SpecialCharTok{\textgreater{}} \DecValTok{0} \SpecialCharTok{\textasciitilde{}}\NormalTok{ vpromesse}\SpecialCharTok{/}\NormalTok{npromesse,}
           \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \DecValTok{0}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{c}\NormalTok{(}
\NormalTok{    vradiations, }\CommentTok{\# valeurs manquantes}
\NormalTok{    nindecis, vdons, ddonsmax,}
\NormalTok{    ddonsmin, vdonsmin, npromesse,}
\NormalTok{    vpromesse, nrefus, nradiations)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{relocate}\NormalTok{(mtdons)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Corrélation pour nouvelles données}
\protect\hypertarget{corruxe9lation-pour-nouvelles-donnuxe9es}{}
\begin{figure}

{\centering \includegraphics[width=0.6\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/unnamed-chunk-5-1.pdf}

}

\end{figure}
\end{frame}

\begin{frame}{Étapes d'une analyse de regroupements}
\protect\hypertarget{uxe9tapes-dune-analyse-de-regroupements}{}
\begin{enumerate}
\tightlist
\item
  Choisir les variables pertinentes à l'analyse. Cette étape peut
  nécessiter de créer, transformer de nouvelles variables ou d'aggréger
  les données.
\item
  Décider quel méthode sera utilisée pour la segmentation.
\item
  Choisir les hyperparamètres de l'algorithme (nombre de regroupements,
  rayon, etc.) et la mesure de dissemblance.
\item
  Assigner les étiquettes aux observations et calculer un prototype de
  groupe.
\item
  Valider la qualité de la segmentation.
\item
  Interpréter les regroupements obtenus à partir des prototypes.
\end{enumerate}
\end{frame}

\begin{frame}{Exemple: typologie des votants en France}
\protect\hypertarget{exemple-typologie-des-votants-en-france}{}
\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{figures/typologie-vote-france.jpg}

}

\end{figure}
\end{frame}

\begin{frame}{Mesures de dissemblance et de similarité}
\protect\hypertarget{mesures-de-dissemblance-et-de-similarituxe9}{}
Comment mesurer si deux observations appartiennent à un même
regroupement et sont similaires?

Une mesure de dissemblance sert à quantifier la proximité de deux objets
à partir de leurs coordoonnées.

Plus la dissemblance est élevée, moins les observations sont semblables
(plus éloignées).
\end{frame}

\begin{frame}{Mesures de dissemblance}
\protect\hypertarget{mesures-de-dissemblance}{}
Quelques propriétés des mesures de dissemblance:

\begin{enumerate}
\tightlist
\item
  positivité: la distance entre deux observations est nulle si et
  seulement si on a les mêmes caractéristiques pour toutes les variables
  explicatives et strictement positive sinon.
\item
  la dissemblance est la même peu importe l'ordre des observations
  (symmétrie)
\end{enumerate}

Toute distance est une mesure de dissemblance.
\end{frame}

\begin{frame}{Distance euclidienne}
\protect\hypertarget{distance-euclidienne}{}
La mesure de dissemblance la plus utilisée en pratique est la distance
euclidienne.

La distance entre les vecteurs ligne \(\mathbf{X}_i\) et
\(\mathbf{X}_j\) (deux lignes de la base de données) est \begin{align*}
d(\mathbf{X}_i, \mathbf{X}_j; l_2) = \left\{(X_{i1}-X_{j1})^2 + \cdots + (X_{ip}-X_{jp})^2\right\}^{1/2}.
\end{align*} C'est tout simplement la longueur du segment qui relie deux
points dans l'espace \(p\) dimensionnel.
\end{frame}

\begin{frame}{Autres mesures de dissemblance}
\protect\hypertarget{autres-mesures-de-dissemblance}{}
\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{figures/distance.pdf}

}

\end{figure}

\begin{itemize}
\tightlist
\item
  La distance de Manhattan est la somme des valeurs absolues entre
  chaque composante, \(|X_{i1}-X_{j1}| + \cdots + |X_{ip}-X_{jp}|\).
\item
  La distance \(l_\infty\), soit le maximum des différences entre les
  coordonnées des vecteurs d'observations \(i\) et \(j\),
  \(\max_{k=1}^p |X_{ik}-X_{jk}|\)
\end{itemize}
\end{frame}

\begin{frame}{Autres mesures de dissemblance}
\protect\hypertarget{autres-mesures-de-dissemblance-1}{}
Pour les données catégorielles nominales, on peut assigner une
dissemblance de 0 si les variables ont la même modalité et 1 sinon.

Pour le cas de variables mixtes, la distance de Gower permet de traiter
les valeurs manquantes et standardise automatiquement.
\end{frame}

\begin{frame}[fragile]{Dissemblances dans \textbf{R}}
\protect\hypertarget{dissemblances-dans-r}{}
Avec notre base de données \texttt{donsmult}, le stockage des distances
prend environ 750MB!

\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\CommentTok{\# Distance euclidienne, de Manhattan, de Gower}
\NormalTok{d1 }\OtherTok{\textless{}{-}} \FunctionTok{dist}\NormalTok{(donsmult, }\AttributeTok{method =} \StringTok{"euclidean"}\NormalTok{)}
\NormalTok{d2 }\OtherTok{\textless{}{-}} \FunctionTok{dist}\NormalTok{(donsmult, }\AttributeTok{method =} \StringTok{"minkowski"}\NormalTok{, }\AttributeTok{p =} \DecValTok{1}\NormalTok{)}
\NormalTok{d3 }\OtherTok{\textless{}{-}}\NormalTok{ cluster}\SpecialCharTok{::}\FunctionTok{daisy}\NormalTok{(donsmult, }\AttributeTok{metric =} \StringTok{"gower"}\NormalTok{)}
\CommentTok{\# Voir aussi ?flexclust::dist2}
\end{Highlighting}
\end{Shaded}

\footnotesize

Les objets de class \texttt{dist} ne stockent que la matrice
triangulaire inférieure (symmétrie).
\end{frame}

\begin{frame}{Au plus fort la poche}
\protect\hypertarget{au-plus-fort-la-poche}{}
Le poids accordé à une variable explicative dépend de son étendu et de
sa variabilité.

\begin{itemize}
\tightlist
\item
  Plus la variable est grande, plus elle aura un impact dans le calcul
  des distances
\item
  Problème de standardisation (résultats différents selon les unités de
  mesure)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Standardisation}
\protect\hypertarget{standardisation}{}
Généralement, on standardise les données avant l'analyse de
regroupements.

\begin{itemize}
\tightlist
\item
  Soustraire la moyenne et diviser par l'écart-type empiriques (fonction
  \texttt{scale} dans \textbf{R})
\item
  utiliser mesures robustes: soustraire médiane et diviser par l'écart
  absolu à la médiane (mad)
\end{itemize}

Notez qu'il est illogique de standardiser les variables catégorielles
(déclarer obligatoirement les variables binaires en facteurs et traiter
à part!)
\end{frame}

\begin{frame}[fragile]{Standardisation avec \textbf{R}}
\protect\hypertarget{standardisation-avec-r}{}
\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\CommentTok{\# Standardisation usuelle}
\CommentTok{\# (soustraire la moyenne, diviser par écart{-}type)}
\NormalTok{donsmult\_std }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(donsmult)}
\CommentTok{\# Extraire moyenne et écart{-}type}
\NormalTok{dm\_moy }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(donsmult\_std, }\StringTok{"scaled:center"}\NormalTok{)}
\NormalTok{dm\_std }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(donsmult\_std, }\StringTok{"scaled:scale"}\NormalTok{)}
\CommentTok{\# Standardisation robuste}
\NormalTok{donsmult\_std\_rob }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(}
\NormalTok{  donsmult,}
  \AttributeTok{MARGIN =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(x)\{(x }\SpecialCharTok{{-}} \FunctionTok{median}\NormalTok{(x))}\SpecialCharTok{/}\FunctionTok{mad}\NormalTok{(x)\})}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Être aux abonnés absents}
\protect\hypertarget{uxeatre-aux-abonnuxe9s-absents}{}
Attention aux valeurs manquantes, rarement supportées par les
algorithmes d'analyse de regroupements.

Quelques solutions

\begin{itemize}
\tightlist
\item
  ignorer les variables explicatives avec beaucoup de valeurs
  manquantes.
\item
  faire une segmentation manuelle si les valeurs manquantes déterminent
  des regroupements (ex: temps entre dons valide uniquement pour dons
  multiples).
\item
  imputer les données manquantes (voir chapitre sur les données
  manquantes)
\end{itemize}
\end{frame}

\begin{frame}{Algorithmes pour la segmentation}
\protect\hypertarget{algorithmes-pour-la-segmentation}{}
L'analyse de regroupements cherche à créer une division de \(n\)
observations de \(p\) variables en regroupements.

\begin{enumerate}
\tightlist
\item
  méthodes basées sur la connectivité (regroupements hiérarchiques
  agglomératifs et divisifs)
\item
  méthodes basées sur les centroïdes et les médoïdes (\(k\)-moyennes,
  \(k\)-médoides)
\item
  mélanges de modèles
\item
  méthodes basées sur la densité
\item
  méthodes spectrales
\end{enumerate}
\end{frame}

\begin{frame}{Critères pour sélection}
\protect\hypertarget{crituxe8res-pour-suxe9lection}{}
\begin{itemize}
\tightlist
\item
  Complexité: plus un algorithme a une complexité élevée (temps de
  calcul et de stockage), moins il sera susceptible d'être applicable à
  des mégadonnées.
\item
  Choix des hyperparamètres: plusieurs paramètres (nombre de groupes,
  rayon, choix de la dissemblance, etc.) à spécifier selon les méthodes.
\end{itemize}
\end{frame}

\begin{frame}{Méthodes basées sur les centroïdes et les médoïdes}
\protect\hypertarget{muxe9thodes-basuxe9es-sur-les-centrouxefdes-et-les-muxe9douxefdes}{}
On assigne chaque observation à un de \(K\) regroupements (le nombre
\(K\) est fixé apriori) représenté par un prototype, disons
\(\boldsymbol{\mu}_k\) pour le regroupement \(k\).

On cherche à assigner les observations aux groupes de manière à
minimiser la distance avec les prototypes.
\end{frame}

\begin{frame}{\(K\) moyennes}
\protect\hypertarget{k-moyennes}{}
Probablement la méthode de regroupement la plus populaire en raison de
son faible coût (linéaire en \(n\) et \(p\)).

La fonction objective considère la distance totale entre observations et
prototypes \begin{equation}\protect\hypertarget{eq-fobjKmoy}{}{
\mathsf{SCD}_K = \min_{\boldsymbol{\mu}_1, \ldots, \boldsymbol{\mu}_K}\underset{\text{distance entre obs. $i$ et son prototype} \mu_j}{\sum_{i=1}^n \min_{c_i \in \{1, \ldots, K\}} d(\mathbf{X}_i,  \boldsymbol{\mu}_{c_i})}
}\label{eq-fobjKmoy}\end{equation}

L'allocation optimale de \(n\) observations à \(K\) groupes est un
problème NP complet: on cherchera plutôt une solution approximative au
problème d'optimisation.
\end{frame}

\begin{frame}{Initialisation des \(K\)-moyennes}
\protect\hypertarget{initialisation-des-k-moyennes}{}
\textbf{Initialisation}: on sélectionne préalablement

\begin{itemize}
\tightlist
\item
  un nombre \(K\) de regroupements et
\item
  les coordonnées de départ pour les prototypes.
\end{itemize}
\end{frame}

\begin{frame}{Algorithme EM}
\protect\hypertarget{algorithme-em}{}
L'algorithme de type EM itère entre deux étapes:

\begin{enumerate}
\tightlist
\item
  \textbf{Assignation} (étape E): calculer la distance entre chaque
  observation et les prototypes; assigner chaque observation au
  prototype le plus près.
\item
  \textbf{Mise à jour} (étape M): calculer les nouveaux prototypes de
  chaque groupe.
\end{enumerate}

L'algorithme termine après un nombre prédéfini d'itérations ou lorsque
l'assignation ne change plus (solution locale).

Visionner l'animation
\href{https://lbelzile.github.io/math60602/03-regroupements_files/figure-html/fig-kmoy-animation-.gif}{en
ligne} ou
\href{https://www.naftaliharris.com/blog/visualizing-k-means-clustering/}{ce
site}.
\end{frame}

\begin{frame}{Forces et faiblesses}
\protect\hypertarget{forces-et-faiblesses}{}
\begin{itemize}
\tightlist
\item
  (\(+\)) Complexité \textbf{linéaire} dans la dimension et dans le
  nombre de variables.
\item
  (\(+\)) L'algorithme converge rapidement vers une solution locale
  (garantie théorique).
\item
  (\(-\)) Regroupements globulaires d'apparence sphérique (distance
  euclidienne).
\item
  (\(+\)) Pour les prédictions, on peut assigner les nouvelles
  observations au barycentre le plus près.
\end{itemize}
\end{frame}

\begin{frame}{Performance}
\protect\hypertarget{performance}{}
\begin{itemize}
\tightlist
\item
  (\(-\)) Chaque observation est assignée à un seul des \(K\)
  regroupements (partition rigide).
\item
  (\(-\)) Valeurs aberrantes pas étiquetées à part (manque de robustesse
  pour moyenne).
\item
  (\(-\)) Sensible aux valeurs initiales des prototypes.
\item
  (\(-\)) Les prototypes ne correspondent pas à des observations du
  groupe.
\end{itemize}
\end{frame}

\begin{frame}{Performance des \(K\)-moyennes}
\protect\hypertarget{performance-des-k-moyennes}{}
Illustration de segmentations problématiques avec \(K\)-moyennes

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/kmoyperfo-1.pdf}

}

\end{figure}
\end{frame}

\begin{frame}{Séparation linéaire de l'espace}
\protect\hypertarget{suxe9paration-linuxe9aire-de-lespace}{}
Avec la distance euclidienne, la partition de l'espace est linéaire.

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{figures/fig-voronoikmoy.png}

}

\caption{\label{fig-voronoy}Partitions de Voronoï pour les regroupements
avec séparateur linéaire.}

\end{figure}
\end{frame}

\begin{frame}{Hyperparamètres avec \(K\)-moyennes}
\protect\hypertarget{hyperparamuxe8tres-avec-k-moyennes}{}
\begin{enumerate}
\tightlist
\item
  le choix de la mesure de distance
\item
  les valeurs initiales des prototypes
\item
  le nombre de groupes \(K\)
\end{enumerate}
\end{frame}

\begin{frame}{Distance}
\protect\hypertarget{distance}{}
Avec la distance euclidienne \(l_2\), les prototypes correspondent avec
le barycentre (moyenne variable par variable) des observations du
regroupement.

Avec la distance de Manhattan \(l_1\), les prototypes correspondent avec
la médiane variable par variable (\(K\)-médianes).

Autrement, optimisation nécessaire dans l'étape \(M\) de l'algorithme.
\end{frame}

\begin{frame}{Initialisation}
\protect\hypertarget{initialisation}{}
Choisir aléatoirement \(K\) observations dans la base de données.

Répéter plusieurs fois et prendre la segmentation avec la valeur
optimale de la fonction objective.

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/fig-kmoyenne-mauvais-1.pdf}

}

\caption{\label{fig-kmoyenne-mauvais}Résultat d'une analyse de
regroupement avec \(K=3\) groupes avec une mauvaise initialisation
principale (gauche) et une bonne initialisation (droite).}

\end{figure}
\end{frame}

\begin{frame}[fragile]{K-moyennes dans \textbf{R}}
\protect\hypertarget{k-moyennes-dans-r}{}
\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{60602}\NormalTok{)}
\NormalTok{kmoy5 }\OtherTok{\textless{}{-}} \FunctionTok{kmeans}\NormalTok{( }\CommentTok{\# distance euclidienne }
   \AttributeTok{x =}\NormalTok{ donsmult\_std, }\CommentTok{\# données}
   \AttributeTok{centers =}\NormalTok{ 5L, }\CommentTok{\# nb groupes}
   \AttributeTok{nstart =} \DecValTok{10}\NormalTok{, }\CommentTok{\# nb initialisation aléatoire}
   \AttributeTok{iter.max =} \DecValTok{25}\NormalTok{) }\CommentTok{\# nb étapes maximum dans optimisation }

\NormalTok{kmoy5}\SpecialCharTok{$}\NormalTok{cluster }\CommentTok{\# étiquettes}
\NormalTok{kmoy5}\SpecialCharTok{$}\NormalTok{size }\CommentTok{\# répartition}
\NormalTok{kmoy5}\SpecialCharTok{$}\NormalTok{tot.withinss }\CommentTok{\# fonction objective minimal}
\NormalTok{kmoy5}\SpecialCharTok{$}\NormalTok{centers }\CommentTok{\# barycentres (données standardisées)}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}{Algorithme des \(K\)-moyennes\({}^{++}\)}
\protect\hypertarget{algorithme-des-k-moyennes}{}
Choisir des observations comme valeurs initiales, mais avec
échantillonnage préférentiel (points éloignés les uns des autres).

\begin{enumerate}
\setcounter{enumi}{-1}
\tightlist
\item
  sélectionner une observation au hasard pour \(\boldsymbol{\mu}_1\)
\end{enumerate}

Pour \(k=2, \ldots, K\)

\begin{enumerate}
\tightlist
\item
  calcul de la distance carrée minimale entre l'observation
  \(\mathbf{X}_i\) et les prototypes précédemment choisis,
  \begin{align*}
  p_i = \min \{d(\mathbf{X}_i, \boldsymbol{\mu}_1; l_2)^2, \ldots, d(\mathbf{X}_i, \boldsymbol{\mu}_{k-1}; l_2)^2)\}
  \end{align*}
\item
  Choisir le prototype initial \(\boldsymbol{\mu}_k\) au hasard parmi
  les observations avec une probabilité de \(p_i/\sum_{j} p_j\) pour
  l'observation \(\mathbf{X}_i\).
\end{enumerate}
\end{frame}

\begin{frame}[fragile]{\(K\)-moyennes\({}^{++}\) dans \textbf{R}}
\protect\hypertarget{k-moyennes-dans-r-1}{}
Utiliser le paquet \texttt{flexclust}

\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{60602}\NormalTok{)}
\NormalTok{kmoypp5 }\OtherTok{\textless{}{-}}\NormalTok{ flexclust}\SpecialCharTok{::}\FunctionTok{kcca}\NormalTok{(}
  \AttributeTok{x =}\NormalTok{ donsmult\_std,}
  \AttributeTok{k =} \DecValTok{5}\NormalTok{, }\CommentTok{\# nb groupes}
  \AttributeTok{family =}\NormalTok{ flexclust}\SpecialCharTok{::}\FunctionTok{kccaFamily}\NormalTok{(}\StringTok{"kmeans"}\NormalTok{),}
  \AttributeTok{control =} \FunctionTok{list}\NormalTok{(}\AttributeTok{initcent =} \StringTok{"kmeanspp"}\NormalTok{))}
\CommentTok{\# Vérifier répartition}
\NormalTok{kmed5}\SpecialCharTok{@}\NormalTok{clusinfo}
\CommentTok{\# Coordonnées des prototypes standardisés}
\NormalTok{kmed5}\SpecialCharTok{@}\NormalTok{centers}
\CommentTok{\# Étiquettes}
\NormalTok{kmed5}\SpecialCharTok{@}\NormalTok{cluster}
\end{Highlighting}
\end{Shaded}
\end{frame}

\begin{frame}[fragile]{Choix du nombre de regroupements}
\protect\hypertarget{choix-du-nombre-de-regroupements}{}
Plusieurs critères généralement applicables

\begin{itemize}
\tightlist
\item
  silhouettes (\texttt{cluster::silhouette})
\item
  statistique d'écart (\texttt{cluster::clusGap})
\end{itemize}

Critères plus spécifiques aux \(K\)-moyennes rattachés à la fonction
objective

\begin{itemize}
\tightlist
\item
  graphique du \(R^2\)
\item
  critère d'information bayésien ``BIC''
\end{itemize}
\end{frame}

\begin{frame}{Somme du carré des distances intra-groupes}
\protect\hypertarget{somme-du-carruxe9-des-distances-intra-groupes}{}
La fonction objective de l'Equation~\ref{eq-fobjKmoy} avec la distance
euclidienne représente la somme du carré des distances (SCD)
\begin{align*}
\mathsf{SCD}_K &= \mathsf{SCD}_{1,K} + \cdots + \mathsf{SCD}_{K,K};
\intertext{où}
\mathsf{SCD}_{k,K} &= \sum_{i \in G_k}\|\mathbf{X}_i -  \boldsymbol{\mu}_{k}\|_2,
\end{align*} est la somme des distance \(l_2\) entre les observation du
groupe \(G_k\) et leur barycentre \(\boldsymbol{\mu}_k\).

Avec un seul groupe, la distance par rapport à la moyenne est
\(\mathsf{SCT} = \mathsf{SCD}_{1}\).
\end{frame}

\begin{frame}{Somme du carré des distances}
\protect\hypertarget{somme-du-carruxe9-des-distances}{}
La valeur optimale de la somme du carré des distances mesure va
mécaniquement\({}^{*}\) diminuer quand \(K\) augmente
\(\mathsf{SCD}_1 > \mathsf{SCD}_2 \cdots\).

En pratique, cela peut ne pas être le cas si le minimum local est
sous-optimal.

Si la réduction de la somme du carré des distances est négligeable, on
pourrait penser que l'ajout d'un groupe supplémentaire.
\end{frame}

\begin{frame}{Critères \(R^2\) et ``BIC''}
\protect\hypertarget{crituxe8res-r2-et-bic}{}
On peut mesurer le pourcentage de variance expliquée,
\[R^2_K = 1-\frac{\mathsf{SCD}_K}{\mathsf{SCT}}.\]

On cherche un point d'inflexion (coude) à partir duquel l'amélioration
est négligeable.

Puisque la somme du carré des distances diminue avec \(K\), on peut
considérer l'ajout d'une pénalité pour le nombre de paramètres estimés

\[\textsf{BIC}=\mathsf{SCD}_K + \ln(n)Kp\]

La plus petite valeur du ``\(\textsf{BIC}\)'' est préférable.
\end{frame}

\begin{frame}{Graphique de coefficient de détermination \(R^2\)}
\protect\hypertarget{graphique-de-coefficient-de-duxe9termination-r2}{}
Le pourcentage de variance expliqué augmente de manière plus ou moins
constante jusqu'à 8 ou 9 composantes.

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/unnamed-chunk-16-1.pdf}

}

\end{figure}
\end{frame}

\begin{frame}{Critère BIC}
\protect\hypertarget{crituxe8re-bic}{}
Le critère suggère aussi un nombre élevé de regroupements, ici 15
(nombre maximum de 15).

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/unnamed-chunk-17-1.pdf}

}

\end{figure}
\end{frame}

\begin{frame}{Silhouettes}
\protect\hypertarget{silhouettes}{}
Pour chaque observation \(\mathbf{X}_i\), on calcule

\begin{itemize}
\tightlist
\item
  \(a_i\), la moyenne des dissimilarités entre \(\mathbf{X}_i\) et les
  observations de son regroupement
\item
  \(b_i\), le minimum parmi les \(K-1\) dissimilarités moyennes entre
  \(\mathbf{X}_i\) et les observations de chaque autre regroupement.
\end{itemize}

On calcule la silhouette \[s_i=\frac{b_i-a_i}{\max\{a_i, b_i\}}\]

Il est possible que la silhouette \(s_i\) soit négative: cela indique
généralement des observations mal regroupées.

De bons regroupements seront obtenus si la silhouette moyenne est
élevée.
\end{frame}

\begin{frame}{Graphique des silhouettes}
\protect\hypertarget{graphique-des-silhouettes}{}
\footnotesize

Coûteux en calcul (nécessite matrice de dissemblance), possible de faire
avec un sous-échantillon aléatoire.

La segmentation de droite de la Figure~\ref{fig-silhouette} est
supérieure parce que les regroupements sont plus homogènes et mieux
équilibrés.

\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/fig-silhouette-1.pdf}

}

\caption{\label{fig-silhouette}Profil des silhouettes pour deux
regroupements d'un jeu de données.}

\end{figure}
\end{frame}

\begin{frame}{Silhouettes avec segmentation des \(K\)-moyennes}
\protect\hypertarget{silhouettes-avec-segmentation-des-k-moyennes}{}
\begin{figure}

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{MATH60602-diapos11_files/figure-beamer/unnamed-chunk-19-1.pdf}

}

\end{figure}
\end{frame}

\begin{frame}{Règle importante pour le choix de \(K\)}
\protect\hypertarget{ruxe8gle-importante-pour-le-choix-de-k}{}
Utilisez votre jugement (et le gros bon sens).

Les segments doivent être interprétables.

Vérifiez que la taille des segments n'est pas fortement débalancée.
\end{frame}

\begin{frame}{Statistiques descriptives par segment}
\protect\hypertarget{statistiques-descriptives-par-segment}{}
\footnotesize

\hypertarget{tbl-kmoy5resume}{}
\begin{table}
\caption{\label{tbl-kmoy5resume}Moyenne des variables explicatives par segment (segmentation avec
K-moyennes et cinq regroupements). }\tabularnewline

\centering
\begin{tabular}{lrrrrr}
\toprule
  & 1 & 2 & 3 & 4 & 5\\
\midrule
décompte & 993 & 64 & 3812 & 4496 & 4252\\
mtdons & 13.92 & 445.49 & 24.98 & 15.32 & 12.11\\
ndons & 2.98 & 11.38 & 13.71 & 4.00 & 4.63\\
recence & 64.56 & 67.14 & 27.34 & 29.00 & 172.06\\
anciennete & 219.46 & 255.45 & 252.77 & 83.59 & 247.85\\
vdonsmax & 22.39 & 1069.30 & 61.19 & 22.53 & 19.23\\
ddons & 7.49 & 1.92 & 1.65 & 1.60 & 1.87\\
nrefusconsec & 1.82 & 0.52 & 0.47 & 0.62 & 3.15\\
snrefus & 3.17 & 0.88 & 1.05 & 4.23 & 2.71\\
mpromesse & 15.32 & 620.32 & 45.13 & 17.70 & 7.67\\
\bottomrule
\end{tabular}
\end{table}
\end{frame}

\begin{frame}{Interprétation des segments}
\protect\hypertarget{interpruxe9tation-des-segments}{}
Les regroupements obtenus sont interprétables:

\begin{itemize}
\tightlist
\item
  Groupe 1: Petits donateurs, faible nombre de dons. N'ont pas donné
  depuis longtemps. Refus fréquents et délai entre dons élevés
\item
  Groupe 2: Grands donateurs fidèles: plus petit groupe. Ces personnes
  ont fait plusieurs dons, leur valeur maximale est élevée. N'ont pas
  donné récemment.
\item
  Groupe 3: Petits fidèles. Dons plus élevés que la moyenne, nombre de
  dons élevés et récents.
\item
  Groupe 4: Petits nouveaux. Moins d'ancienneté, dons récents et refus
  fréquents relativement à l'ancienneté.
\item
  Groupe 5: Donateurs inactifs. Faible montant de dons, plutôt anciens,
  plusieurs refus.
\end{itemize}
\end{frame}

\begin{frame}{Récapitulatif}
\protect\hypertarget{ruxe9capitulatif}{}
\begin{itemize}
\tightlist
\item
  L'analyse de regroupement (\emph{clustering}) est une méthode
  d'apprentissage non-supervisée
\item
  Plusieurs choix de l'analyste (mesure de dissemblance, algorithme,
  choix des hyperparamètres) peut donner une segmentation différente
\item
  L'algorithme des \(K\)-moyennes est le plus employé et son faible coût
  permet son utilisation avec des mégadonnées.
\end{itemize}
\end{frame}



\end{document}
